// Маппинг колонок для загрузки (английские названия -> русские)
export const uploadColumnMappings: Record<string, string> = {
  'Op_1_Bl_1_Sht': 'Упаковка товара в индивидуальный короб',
  'Op_2_Bl_2_Sht': 'Пересчет товара',
  'Op_3_Bl_3_Sht': 'Фасовка/сборка монотовара в короб',
  'Op_4_Bl_4_Sht': 'Маркировка товара стикером',
  'Op_5_Bl_5_Sht': 'Маркировка транспортного короба',
  'Op_6_Blis_6_10_Sht': 'Маркировка паллета (транспортного модуля)',
  'Op_7_Pereschyot': 'Удаление стикера/маркировки с товара',
  'Op_9_Fasovka_Sborka': 'Термоупаковка товара',
  'Op_10_Markirovka_SHT': 'Разбор товара (для маркетплейсов)',
  'Op_469_Spetsifikatsiya_TM': 'Спецификация ТМ (для маркетплейсов)',
  'Op_11_Markirovka_Prom': 'Подготовка транспортного паллета к отгрузке',
  'Op_13_Markirovka_Fabr': 'Раскомплект заказа (полный/частичный)',
  'Ne_Sortiruemyi_Tovar': 'Не сортируемый товар',
  'Produkty': 'Продукты',
  'Opasnyi_Tovar': 'Опасный товар',
  'Zakrytaya_Zona': 'Закрытая зона',
  'Op_470_Dop_Upakovka': 'Проверка штрих-кода / срока годности',
  'Krupnogabaritnyi_Tovar': 'Крупногабаритный товар',
  'Yuvelirnye_Izdelia': 'Ювелирные изделия',
  'Op_16_TU_3_5': 'Упаковка в пакет с клеевым слоем',
  'Op_17_TU_6_8': 'Упаковка в пакет с замком Zip Lock',
  'Op_468_Proverka_SHK': 'Упаковка в бабл - пленку',
  'Upakovka_v_Gofro': 'Тип операции',
  'PriznakSortirovki': 'Сортируемый товар',
  'Vlozhit_v_upakovku_pechatnyi_material': 'Вложить в упаковку печатный материал',
  'Izmerenie_VGH_i_peredacha_informatsii': 'Измерение ВГХ и передача информации',
  'Indeks_za_srochnost_koeff_1_5': 'Индекс за срочность (коэффициент 1,5)',
  'Prochie_raboty_vklyuchaya_ustranenie_anomalii': 'Прочие работы включая устранение аномалий',
  'Sborka_naborov_ot_2_shtuk_raznykh_tovarov': 'Сборка наборов от 2 штук разных товаров',
  'Upakovka_tovara_v_gofromeyler': 'Упаковка товара в гофромейлер',
  'Khranenie_tovara': 'Хранение товара',

  // Основные поля
  'Artikul': 'Артикул',
  'Artikul_Syrya': 'Артикул Сырья',
  'Nomenklatura': 'Номенклатура',
  'Nazvanie_Tovara': 'Название товара',
  'SHK': 'ШК',
  'SHK_Syrya': 'ШК Сырья',
  'Kol_vo_Syrya': 'Кол-во сырья',
  'Itog_Zakaz': 'Итог Заказ',
  'SOH': 'СОХ',
  'Srok_Godnosti': 'Срок Годности',
  'Upakovka_v_PE_Paket': 'Упаковка в ПЭ пакет',
  'vp': 'ВП',
  
  // Дополнительные поля для времени и комментариев
  'reason': 'Причина',
  'comment': 'Комментарий',
  'Time_Start': 'Начало',
  'Time_End': 'Окончание',
  'time_start': 'Начало',
  'time_end': 'Окончание'
}

// Маппинг колонок для скачивания (английские названия -> русские)
export const downloadColumnMappings: Record<string, string> = {
  'Op_1_Bl_1_Sht': 'Упаковка товара в индивидуальный короб',
  'Op_2_Bl_2_Sht': 'Пересчет товара',
  'Op_3_Bl_3_Sht': 'Фасовка/сборка монотовара в короб',
  'Op_4_Bl_4_Sht': 'Маркировка товара стикером',
  'Op_5_Bl_5_Sht': 'Маркировка транспортного короба',
  'Op_6_Blis_6_10_Sht': 'Маркировка паллета (транспортного модуля)',
  'Op_7_Pereschyot': 'Удаление стикера/маркировки с товара',
  'Op_9_Fasovka_Sborka': 'Термоупаковка товара',
  'Op_10_Markirovka_SHT': 'Разбор товара (для маркетплейсов)',
  'Op_469_Spetsifikatsiya_TM': 'Спецификация ТМ (для маркетплейсов)',
  'Op_11_Markirovka_Prom': 'Подготовка транспортного паллета к отгрузке',
  'Op_13_Markirovka_Fabr': 'Раскомплект заказа (полный/частичный)',
  'Ne_Sortiruemyi_Tovar': 'Не сортируемый товар',
  'Produkty': 'Продукты',
  'Opasnyi_Tovar': 'Опасный товар',
  'Zakrytaya_Zona': 'Закрытая зона',
  'Op_470_Dop_Upakovka': 'Проверка штрих-кода / срока годности',
  'Krupnogabaritnyi_Tovar': 'Крупногабаритный товар',
  'Yuvelirnye_Izdelia': 'Ювелирные изделия',
  'Op_16_TU_3_5': 'Упаковка в пакет с клеевым слоем',
  'Op_17_TU_6_8': 'Упаковка в пакет с замком Zip Lock',
  'Op_468_Proverka_SHK': 'Упаковка в бабл - пленку',
  'Upakovka_v_Gofro': 'Тип операции',
  'PriznakSortirovki': 'Сортируемый товар',
  'Vlozhit_v_upakovku_pechatnyi_material': 'Вложить в упаковку печатный материал',
  'Izmerenie_VGH_i_peredacha_informatsii': 'Измерение ВГХ и передача информации',
  'Indeks_za_srochnost_koeff_1_5': 'Индекс за срочность (коэффициент 1,5)',
  'Prochie_raboty_vklyuchaya_ustranenie_anomalii': 'Прочие работы (в т.ч. устранение аномалий)',
  'Sborka_naborov_ot_2_shtuk_raznykh_tovarov': 'Сборка наборов (комплектов) от 2-х штук разных товаров',
  'Upakovka_tovara_v_gofromeyler': 'Упаковка товара в гофромейлер',
  'Khranenie_tovara': 'Хранение товара',
  
  
  // Основные поля
  'Artikul': 'Артикул',
  'Artikul_Syrya': 'Артикул Сырья',
  'Nomenklatura': 'Номенклатура',
  'Nazvanie_Tovara': 'Название товара',
  'SHK': 'ШК',
  'SHK_Syrya': 'ШК Сырья',
  'Kol_vo_Syrya': 'Кол-во сырья',
  'Itog_Zakaz': 'Итог Заказ',
  'SOH': 'СОХ',
  'Srok_Godnosti': 'Срок Годности',
  'Upakovka_v_PE_Paket': 'Упаковка товара в п/э пакет',
  
  // Дополнительные поля
  'Nazvanie_Zadaniya': 'Название задания',
  'Scklad_Pref': 'Склад',
  'pref': 'Префикс',
  'Pallet_No': 'Паллет №',
  'Mesto': 'Место',
  'Ispolnitel': 'Исполнитель',
  'Vlozhennost': 'Вложенность',
  'Kolvo_Tovarov': 'Количество товаров',
  'SHK_WPS': 'ШК WPS',
  'vp': 'ВП',
  
  // Дополнительные поля для времени и комментариев
  'reason': 'Причина',
  'comment': 'Комментарий',
  'Time_Start': 'Начало',
  'Time_End': 'Окончание',
  'time_start': 'Начало',
  'time_end': 'Окончание'
}

// Обратный маппинг для загрузки (русские названия -> английские)
export const reverseUploadColumnMappings: Record<string, string> = Object.fromEntries(
  Object.entries(uploadColumnMappings).map(([key, value]) => [value, key])
)

// Порядок колонок для отчета (соответствует изображению)
export const desiredColumnOrder = [
  "ВП", "Название задания", "Артикул", "Артикул Сырья", "Название товара", "Номенклатура", "ШК", "ШК Сырья", 
  "Кол-во сырья", "Итог Заказ", "Итог МП", "СОХ", "Срок Годности",
  // Точная последовательность операций согласно требованиям пользователя
  "Упаковка в пакет с клеевым слоем",
  "Упаковка в пакет с замком Zip Lock",
  "Упаковка товара в гофромейлер",
  "Упаковка товара в п/э пакет",
  "Упаковка в бабл - пленку",
  "Упаковка товара в индивидуальный короб",
  "Пересчет товара",
  "Фасовка/сборка монотовара в короб",
  "Маркировка товара стикером",
  "Маркировка транспортного короба",
  "Маркировка паллета (транспортного модуля)",
  "Удаление стикера/маркировки с товара",
  "Термоупаковка товара",
  "Проверка штрих-кода / срока годности",
  "Спецификация ТМ (для маркетплейсов)",
  "Разбор товара (для маркетплейсов)",
  "Подготовка транспортного паллета к отгрузке",
  "Раскомплект заказа (полный/частичный)",
  "Сборка наборов (комплектов) от 2-х штук разных товаров",
  "Вложить в упаковку печатный материал",
  "Хранение товара",
  "Измерение ВГХ и передача информации",
  "Индекс за срочность (коэффициент 1,5)",
  "Прочие работы (в т.ч. устранение аномалий)",
  "Тип операции",
  "Сортируемый товар",
  "Не сортируемый товар",
  "Продукты",
  "Опасный товар",
  "Закрытая зона",
  "Крупногабаритный товар",
  "Ювелирные изделия",
  // Дополнительные поля (исключенные колонки убраны)
  "Фактическое количество", "Убрано из заказа", "Место", "Вложенность", "Паллет №",
  "Исполнитель", "ШК WPS", "Причина", "Комментарий", "Начало", "Окончание"
]

// Функция обработки значений операций (как в test.py)
export const processOpColumnValue = (value: any): string | null => {
  if (value !== null && value !== undefined) {
    const valueStr = String(value).trim()
    
    // Если значение равно 'V', возвращаем '1'
    if (valueStr === 'V') {
      return '1'
    }
    
    try {
      // Пытаемся преобразовать в число
      const floatValue = parseFloat(valueStr)
      return String(Math.floor(floatValue)) // Возвращаем целое число
    } catch {
      // Если это не число, возвращаем 'V'
      return 'V'
    }
  }
  
  return value
}

// Для обратной совместимости
export const getColumnNames = () => uploadColumnMappings
export const getDownloadColumnNames = () => downloadColumnMappings 